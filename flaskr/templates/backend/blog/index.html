{% extends "backend/layout/base.html" %}

{% block header %}
    <h1>{% block title %}Posts{% endblock %}</h1>
{% endblock %}

{% block content %}
    <div class="col-md-12 text-end">
        {% if g.user %}
            <a class="btn btn-success" href="{{ url_for('backend.blog.create') }}">Crear nuevo</a>
        {% endif %}
    </div>
    <div class="col-md-12">
        <table id="example" class="display" style="width:100%">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Autor</th>
                    <th>Autor Email</th>
                    <th>Título</th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tfoot>
                <tr>
                    <th>ID</th>
                    <th>Autor</th>
                    <th>Autor Email</th>
                    <th>Título</th>
                    <th></th>
                    <th></th>
                </tr>
            </tfoot>
        </table>
    </div>
    <div class="col-md-12">
        {% if blogposts is defined %}
            {% for post in blogposts %}
                <article>
                    <header>
                        <div>
                            <h1>{{ post.blog.title }}</h1>
                            <div>Creado por <a href="mailto:{{ post.user.email }}">{{ post.user.nombre }}</a> el {{ post.blog.created_at.strftime('%Y-%m-%d') }}</div>
                        </div>
                        {% if g.user['id'] == post.blog.author_id %}
                        <a href="{{ url_for('backend.blog.edit', id=post['id']) }}">Edit</a>
                        {% endif %}
                    </header>
                    <p>{{ post['contenido'] }}</p>
                </article>
                {% if not loop.last %}
                    <hr>
                {% endif %}

            {% endfor %}

        {% else %}
            <p>La variable blogsposts no está definida.</p>
        {% endif %}
    </div>
{% endblock %}

{% block scripts %}
    <script>
        jQuery(document).ready(function() {
            jQuery('#example').DataTable({
                'processing': true,
                'serverSide': true,
                'serverMethod': 'post',
                'lengthMenu': [
                    [5, 10, 50, 100, -1],
                    [5, 10, 50, 100, 'Todos']
                ],
                'order': [ [0, 'asc'] ],
                'searching': true,
                'ajax': {
                    'url': 'http://localhost:5000/backend/blog/datatable',
                },
                'columns': [
                    {data: "id"},
                    {data: "autor"},
                    {data: "autor_email"},
                    {data: "titulo"},
                    {data: "editar"},
                    {data: "eliminar"}
                ],
                'language': {
                    'lengthMenu': 'Mostrar _MENU_ Posts',
                    'zeroRecords': 'No hay Posts',
                    'info': 'Mostrando pagina _PAGE_ de _PAGES_',
                    'infoEmpty': 'No hay Posts disponibles',
                    'infoFiltered': '(Total: _MAX_ Posts)',
                    'search': 'Buscar'
                }
            });
        });
    </script>
{% endblock %}
